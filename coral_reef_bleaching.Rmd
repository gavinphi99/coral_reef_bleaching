---
title: "Coral Reef Bleaching"
output: html_document
date: "2022-09-29"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
library(tidyverse)
library(reshape2)
library(stringr)
library(maptools)
library(maps)
library(lubridate)


df <- read_csv("bcodmo_dataset_773466_712b_5843_9069.csv")
df <- df[-1, ]
head(df)
```

```{r}

# data$ClimSST

month <- c()
for (x in df$Date) {
  # print(substr(x, 1, 1))
  month = c(month, strsplit(x, split="/")[[1]][1])
}
# month
month <- as.integer(month)
head(month)


df$month <- month

# head(data$month)


# data$month
```
```{r}
df$ClimSST <- as.double(df$ClimSST) - 273
```

```{r}

df %>% mutate(month2 = recode(month,"Jan","Feb", "Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec")) %>% mutate(month2=factor(month2, levels=c("Jan","Feb", "Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"))) %>% group_by(month2) %>% summarize(sst_mean = mean(ClimSST, na.rm=T)) %>% ggplot(aes(x=month2, y=sst_mean, fill=sst_mean)) + 
  geom_bar(stat="identity") + theme(legend.position = 'none') + 
  scale_fill_gradientn(colors=c("blue", "red")) + xlab("Months") + ylab("SST (°C)") + ggtitle("Average Sea Surface Temperatures by Month")
```

```{r}
df$longitude <- round(as.double(df$longitude), 0)
df$latitude <- round(as.double(df$latitude), 0)

```


```{r}
world <- map_data("world")

ggplot(df) + geom_raster(aes(x = longitude, y = latitude, fill=ClimSST), interpolate=T) + geom_polygon(aes(long, lat, group=group), data = world, fill = "grey80") + scale_fill_gradientn(colours = rev(rainbow(7)), na.value = NA) + theme_bw() + coord_fixed(1.3) + xlab("Longitute (deg)") + ylab("Latitude (deg)") + ggtitle("Data Collection Areas") + labs(fill = "SST Temps. (°C)")
```
```{r}
df2 <- df %>% group_by(City_Town) %>% filter(substr(Date2, 1, 4)=="2016") %>% summarize(Mean_Average_Bleaching = sum(as.double(Average_Bleaching)))
df2
```
```{r}
df2 %>% ggplot
```


```{r}
df <- df %>% group_by(City_Town) %>% arrange(Date2)
df
```

```{r}
num_ble <- as.numeric(df$Average_Bleaching)
city_town_vect <- df$City_Town

tot_inc_ble <- c()

for (i in 2:length(num_ble)-1) {
  if (city_town_vect[i]==city_town_vect[i+1] & !is.na(city_town_vect[i]) & !is.na(city_town_vect[i+1])) {
     tot_inc_ble <- c(tot_inc_ble, num_ble[i] + num_ble[i+1])
  }
  else {
    tot_inc_ble <- c(tot_inc_ble, num_ble[i])
  }
}

df$Compound_Average_Bleaching <- tot_inc_ble
df %>% filter(City_Town == "Magnetic Island")

```


```{r}
df %>% filter(City_Town=="Magnetic Island") %>% ggplot(aes(Date2, Compound_Average_Bleaching)) + geom_point() + theme(legend.position = "none")

```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
